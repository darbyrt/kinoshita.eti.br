  <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
    <title>Bruno P. Kinoshita</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="Bruno de Paula Kinoshita personal web site" />
    <meta name="keywords"
        content="kinoshita, bruno de paula kinoshita, geek, geek stuff, java, python, c, c++, msn now playing, neural network, mackenzie, sao paulo, brasil, brazil, nerd, nerd stuff, cool, jenkins, illustration, quadrinhos, machine learning, linguistic, apache, open source, codigo livre, codigo aberto" />
    <meta name="author" content="Bruno P. Kinoshita" />
    <meta name="generator" content="PieCrust 1.2.0" />
    <meta name="template-engine" content="Twig" />
    <meta name="robots" content="all=index,follow" />
    <meta name="revisit-after" content="15 days" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta name="distribution" content="Global" />
    <meta name="url" content="http://kinoshita.eti.br/" />
    <meta name="copyright" content="Bruno de Paula Kinoshita" />
    <meta name="Googlebot" content="all" />
    <meta name="rating" content="general" />
    <meta http-equiv="expires" content="0" />
    <meta name="city" content="Sao Paulo" />
    <meta name="state" content="Brasil, Sao Paulo" />
    <meta http-equiv="content-language" content="en" />
    <meta http-equiv="imagetoolbar" content="no" />
    <meta id="page_favicon" href="http://kinoshita.eti.br/favicon.ico" rel="icon" type="image/x-icon" />
    <link rel="shortcut icon" type="image/x-icon" href="http://kinoshita.eti.br/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="alternate" type="application/rss+xml" title="Bruno P. Kinoshita &raquo; Feed" href="http://kinoshita.eti.br//feed.xml" />
    <link rel="stylesheet" href="http://kinoshita.eti.br/css/semantic/dist/semantic.min.css" type="text/css" media="screen, projection" />
    <link rel="stylesheet" href="http://kinoshita.eti.br/css/style.css" type="text/css" media="screen, projection" />
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/css/blueprint/ie.css" type="text/css" media="screen, projection" />
    <![endif]-->
    <link rel="stylesheet" href="http://kinoshita.eti.br/css/prettyPhoto.css" type="text/css" media="all" />
</head>
<body id="body">
    <div class="ui vertical sidebar menu" id="toc">
        <div class="menu">
    <div class="item">
        <a href="http://kinoshita.eti.br/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/software.html">Software</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/articles.html">Articles</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/books.html">Books</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/about.html">About &#038; CV</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/contact.html">Contact</a>
    </div>
</div>
<img id="me" src="http://kinoshita.eti.br/img/bruno.jpg" title="Hmmmm" alt="Hmmmm" width="134px" height="215px" />    </div>
    <div class="ui black big launch right attached fixed button">
        <i class="content icon"></i>
        <span class="text">Menu</span>
    </div>
    <div class="ui fixed inverted main menu">
        <div class="ui container">
            <a class="launch icon item">
                <i class="content icon"></i>
            </a>
            <div class="item">
                
            </div>
        </div>
    </div>
    <div class="pusher">
        <div class="full height">
            <div class="toc">
                <div class="ui vertical sticky fixed top menu">
                    <div class="menu">
    <div class="item">
        <a href="http://kinoshita.eti.br/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/software.html">Software</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/articles.html">Articles</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/books.html">Books</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/about.html">About &#038; CV</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/contact.html">Contact</a>
    </div>
</div>
<img id="me" src="http://kinoshita.eti.br/img/bruno.jpg" title="Hmmmm" alt="Hmmmm" width="134px" height="215px" />                </div>
            </div>
            <div class="article">
                <div class="main container">

                                                        <p>Posts tagged with &#8216;jenkins&#8217;</p>

<div class="ui raised padded text container segment">
    <h2>Trying SaltStack with Docker</h2>
    <p><small>kinow</small> @ <small>April 17, 2016&nbsp;22:06:03</small></p>
    <div><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://kinoshita.eti.br/2016/04/17/trying-saltstack-with-docker.html" data-text="Trying SaltStack with Docker" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>
    <p>Some weeks ago I started learning <a href="http://saltstack.com/">SaltStack</a> for a project at work. But I couldn&#8217;t
find a good Docker image for that and I had to ask the Ops team for some VM&#8217;s. We
are having a rainy weekend in Auckland, so I decided to have another look at the
<a href="https://wiki.jenkins-ci.org/display/JENKINS/saltstack-plugin">Jenkins SaltStack Plug-in</a>.</p>

<p>But now since I was at home, I couldn&#8217;t use the VM&#8217;s that I had access to at
work. So decided to look again at Docker or Vagrant images. After playing
with a few images, I found <a href="https://hub.docker.com/r/bbinet/salt-master/">bbinet/salt-master</a>.
It not only sets up a master, but also provides an easy way to enable the cherrypy
API (necessary for the Jenkins plug-in).</p>

<p>This post describes the steps that I took to have a running Salt Master with the API
enabled. First you need to create some directories and files to use with the image.</p>

<pre class="shell" style="font-family:monospace;">shell$ mkdir ~/master &amp;&amp; cd ~/master
shell$ mkdir -p config/master.d/
shell$ vim config/master.d/api.conf</pre>

<p>The api.conf contains the SaltStack API configuration. You can change port, user
and other settings if necessary. Just remember to add a credential in Jenkins
for the plug-in.</p>

<pre class="shell" style="font-family:monospace;"># File: api.conf
external_auth:
  pam:
    saltapiuser:
      - .*
      - '@runner'
      - '@wheel'
      - '@jobs'
rest_cherrypy:
  port: 8000
  host: 0.0.0.0
  disable_ssl: True
  static: /opt/molten
  static_path: /assets
  app: /opt/molten/index.html
  app_path: /molten</pre>

<p>The image also conveniently provides a script that is executed before the
entry point (if provided). So we can also create a user for the API automatically
when the image is created.</p>

<pre class="shell" style="font-family:monospace;">shell$ vim config/before-exec.sh</pre>

<pre class="shell" style="font-family:monospace;">#!/bin/bash
# File: before-exec.sh
useradd saltapiuser
echo -e &quot;nosecret\nnosecret\n&quot; | passwd saltapiuser
exit 0</pre>

<p>Also make the script executable.</p>

<pre class="shell" style="font-family:monospace;">chmod +x config/before-exec.sh</pre>

<p>And finally start the container.</p>

<pre class="shell" style="font-family:monospace;">docker run --name salt-master -v $PWD/config:/config \
    -p 4505:4505 -p 4506:4506 -p 443:443 -p 8000:8000 \
    bbinet/salt-master</pre>

<p>Once the container is running, you can go to http://localhost:8000 and
log in as saltapiuser:nosecret, and also configure your plug-in
in Jenkins.</p>

<p>Happy hacking!</p>
<!-- html -->
        <p class="postmetadata">
                <small>tags          [&nbsp;<a
            href="/tag/jenkins.html"
            rel="tag">jenkins</a>&nbsp;]&nbsp;
                 [&nbsp;<a
            href="/tag/docker.html"
            rel="tag">docker</a>&nbsp;]&nbsp;
                 [&nbsp;<a
            href="/tag/saltstack.html"
            rel="tag">saltstack</a>&nbsp;]&nbsp;
                </small>
                        <br/>
        <small>posted in 
        [&nbsp;<a
            href="/blog.html"
            title="View all posts in blog"
            rel="category tag">blog</a>&nbsp;]&nbsp;
        category </small>
            </p>
</div>

<p><div class="ui raised padded text container segment">
    <h2>Deploying WAR files to Tomcat with Jenkins</h2>
    <p><small>kinow</small> @ <small>March 20, 2016&nbsp;15:29:03</small></p>
    <div><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://kinoshita.eti.br/2016/03/20/deploying-war-files-to-tomcat-with-jenkins.html" data-text="Deploying WAR files to Tomcat with Jenkins" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>
    <p><strong>Table of Contents</strong></p></p>

<ul>
<li><a href="#1-deploying-with-custom-scripts">Deploying with custom scripts</a></li>
<li><a href="#2-deploying-with-a-build-tool">Deploying with a build tool</a></li>
<li><a href="#3-deploying-with-a-build-server">Deploying with a build server</a></li>
<li><a href="#final-thoughts">Final thoughts</a></li>
</ul>

<p>A co-worker asked me this week about how to deploy a WAR file to Tomcat with Jenkins. In my team we are
currently maintaining and deploying about 10 Java web systems, but we have no consistent way of deploying
the applications to Tomcat yet. In the past I used Ant, Maven, Cargo, Grunt, and Jenkins, so I
decided to write this short post to show a few different ways it can be achieved, &agrave; la
<a href="https://en.wikipedia.org/wiki/There's_more_than_one_way_to_do_it">Perl&#8217;s TMTOWTDI</a> motto.</p>

<h2><a name="1-deploying-with-custom-scripts" style="color: #222222;">#1 Deploying with custom scripts</a></h2>

<p>At first you may be tempted to write your own script to deploy to Tomcat with some Shell, Perl, Python
or Java. But I think I would choose this option only because either I needed some feature that is not
available in the other options, or in order to call other tasks or debug some problem.</p>

<p>Example:</p>

<pre class="bash" style="font-family:monospace;">$ docker run <span style="color: #660033;">-d</span> <span style="color: #660033;">-p</span> <span style="color: #000000;">8888</span>:<span style="color: #000000;">8080</span> jeanblanchard<span style="color: #000000; font-weight: bold;">/</span>tomcat:<span style="color: #000000;">8</span>
$ <span style="color: #c20cb9; font-weight: bold;">git clone</span> https:<span style="color: #000000; font-weight: bold;">//</span>github.com<span style="color: #000000; font-weight: bold;">/</span>spring-projects<span style="color: #000000; font-weight: bold;">/</span>spring-petclinic.git <span style="color: #000000; font-weight: bold;">&amp;&amp;</span> <span style="color: #7a0874; font-weight: bold;">cd</span> spring-petclinic <span style="color: #000000; font-weight: bold;">&amp;&amp;</span> mvn package
$ curl <span style="color: #660033;">--upload-file</span> target<span style="color: #000000; font-weight: bold;">/</span>petclinic.war <span style="color: #ff0000;">&quot;http://admin:admin@localhost:8888/manager/text/deploy?path=/spring-petclinic&amp;update=true&quot;</span>
OK - Deployed application at context path <span style="color: #000000; font-weight: bold;">/</span>spring-petclinic</pre>

<p><!-- html -->
        <p>( <a href="/2016/03/20/deploying-war-files-to-tomcat-with-jenkins.html" >Read more &#8230;</a> )</p>
        <p class="postmetadata">
                <small>tags          [&nbsp;<a
            href="/tag/jenkins.html"
            rel="tag">jenkins</a>&nbsp;]&nbsp;
                 [&nbsp;<a
            href="/tag/tomcat.html"
            rel="tag">tomcat</a>&nbsp;]&nbsp;
                 [&nbsp;<a
            href="/tag/docker.html"
            rel="tag">docker</a>&nbsp;]&nbsp;
                </small>
                        <br/>
        <small>posted in 
        [&nbsp;<a
            href="/blog.html"
            title="View all posts in blog"
            rel="category tag">blog</a>&nbsp;]&nbsp;
        category </small>
            </p>
</div>
<div class="ui raised padded text container segment">
    <h2>How does the Jenkins Credentials Plug-in store passwords?</h2>
    <p><small>kinow</small> @ <small>September 7, 2015&nbsp;01:25:03</small></p>
    <div><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://kinoshita.eti.br/2015/09/07/how_does_the_jenkins_credentials_plugin_store_passwords.html" data-text="How does the Jenkins Credentials Plug-in store passwords?" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>
    <p><a href="https://wiki.jenkins-ci.org/display/JENKINS/Credentials+Plugin">Jenkins Credentials Plug-in</a> manages credentials stored in Jenkins. These credentials can be used in many jobs and by plug-ins for executing SSH commands, authenticating to systems, or running other commands that need some sort of authentication or authorisation.</p></p>

<p>I recently used its API for the first time in the <a href="https://github.com/biouno/figshare-plugin">BioUno figshare Plug-in</a> to store OAuth 1.0 credentials (consumer key, consumer secret, token key, token secret). This <a href="http://biouno.org/2015/09/05/using_jenkins_credentials_plugin_to_create_the_biouno_figshare_plugin/">blog post</a> has more details about how we used the plug-in, but this post is specifically on how the passwords are stored by Jenkins.</p>

<h2>Secret and ciphers</h2>

<p>Jenkins stores its configuration on disk as XML using the XStream library. Plug-in developers using the Credentials Plug-in API must use the <strong>Secret</strong> class to encrypt sensitive information.</p>

<p>The <code>Secret.fromString</code> method is responsible for creating a cipher from a given String. As in the Secret Javadoc,  <em>&#8220;this is not meant as a protection against code running in the same VM, nor against an attacker who has local file system access on Jenkins master&#8221;</em>. But at least makes things more complicated :-)</p>

<ul>
<li><a href="http://javadoc.jenkins-ci.org/hudson/util/Secret.html">Secret Javadoc</a></li>
<li><a href="https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/hudson/util/Secret.java">Secret source code</a></li>
</ul>

<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> Secret fromString<span style="color: #009900;">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span style="color: #003399;">String</span></a> data<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    data <span style="color: #339933;">=</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+util"><span style="color: #003399;">Util</span></a>.<span style="color: #006633;">fixNull</span><span style="color: #009900;">&#40;</span>data<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Secret s <span style="color: #339933;">=</span> decrypt<span style="color: #009900;">&#40;</span>data<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #000000; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span>s<span style="color: #339933;">==</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> s<span style="color: #339933;">=</span><span style="color: #000000; font-weight: bold;">new</span> Secret<span style="color: #009900;">&#40;</span>data<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #000000; font-weight: bold;">return</span> s<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre>

<p>The first line simply replaces a null string by an empty &#8220;&#8221;, or keeps the current value of not null.</p>

<p>After that, the decrypt method is called.</p>

<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> Secret decrypt<span style="color: #009900;">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span style="color: #003399;">String</span></a> data<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #000000; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span>data<span style="color: #339933;">==</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span>      <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
    <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #000066; font-weight: bold;">byte</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> in <span style="color: #339933;">=</span> Base64.<span style="color: #006633;">decode</span><span style="color: #009900;">&#40;</span>data.<span style="color: #006633;">toCharArray</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        Secret s <span style="color: #339933;">=</span> tryDecrypt<span style="color: #009900;">&#40;</span>KEY.<span style="color: #006633;">decrypt</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, in<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>s<span style="color: #339933;">!=</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span>    <span style="color: #000000; font-weight: bold;">return</span> s<span style="color: #339933;">;</span>
&nbsp;
        <span style="color: #666666; font-style: italic;">// try our historical key for backward compatibility</span>
        Cipher cipher <span style="color: #339933;">=</span> getCipher<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;AES&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        cipher.<span style="color: #006633;">init</span><span style="color: #009900;">&#40;</span>Cipher.<span style="color: #006633;">DECRYPT_MODE</span>, getLegacyKey<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">return</span> tryDecrypt<span style="color: #009900;">&#40;</span>cipher, in<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+generalsecurityexception"><span style="color: #003399;">GeneralSecurityException</span></a> e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+unsupportedencodingexception"><span style="color: #003399;">UnsupportedEncodingException</span></a> e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+error"><span style="color: #003399;">Error</span></a><span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// impossible</span>
    <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+ioexception"><span style="color: #003399;">IOException</span></a> e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span></pre>

<p>The <code>KEY.decrypt()</code> call will return a <a href="http://docs.oracle.com/javase/8/docs/api/javax/crypto/Cipher.html"><code>javax.crypto.Cipher</code></a>. The Cipher class is handled in <a href="https://github.com/jenkinsci/jenkins/blob/93dfe3377ec8d430818f5b9073f16c677343adb4/core/src/main/java/jenkins/security/CryptoConfidentialKey.java">CryptoConfidentialKey</a> in Jenkins API, where it defines the algorithm used to create the cipher: <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a>.</p>

<p>Jenkins has also a <a href="https://github.com/jenkinsci/jenkins/blob/93dfe3377ec8d430818f5b9073f16c677343adb4/core/src/main/java/jenkins/security/ConfidentialStore.java#L63">ConfidentialStore</a>, that is required to create the cipher. This class must be initialized before someone tries to create or read a cipher. This extra step also increases security, though access to the JVM is still a problem.</p>

<p>It is a bit late, so it is all for today. In summary: the credentials plug-in gives you a central place to manage credentials, but it is up to plug-in developers to use it. Sensitive values can be encrypted with AES on disk. So it is important that your file permissions, ACL and system auditing processes are in place and well maintained and monitored.</p>

<p>Happy hacking!</p>

<p><!-- html -->
        <p class="postmetadata">
                <small>tags          [&nbsp;<a
            href="/tag/jenkins.html"
            rel="tag">jenkins</a>&nbsp;]&nbsp;
                 [&nbsp;<a
            href="/tag/security.html"
            rel="tag">security</a>&nbsp;]&nbsp;
                </small>
                        <br/>
        <small>posted in 
        [&nbsp;<a
            href="/blog.html"
            title="View all posts in blog"
            rel="category tag">blog</a>&nbsp;]&nbsp;
        category </small>
            </p>
</div>
<div class="ui raised padded text container segment">
    <h2>Groovy Hooks in Jenkins for increasing logging level</h2>
    <p><small>kinow</small> @ <small>April 12, 2015&nbsp;11:30:03</small></p>
    <div><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://kinoshita.eti.br/2015/04/12/groovy-hooks-in-jenkins-for-increasing-logging-level.html" data-text="Groovy Hooks in Jenkins for increasing logging level" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>
    <p>Yesterday, while debugging a problem we had in the <a href="http://biouno.org">BioUno</a> update center, 
I realized that after <a href="https://wiki.jenkins-ci.org/display/JENKINS/Logging">increasing the logging level in the WEB interface</a>, 
the messages that I needed weren&#8217;t being displayed in the logs.</p></p>

<p>It happened because some of the logging happened during Jenkins initialization, and before I could adjust the log level.</p>

<p>The solution was to use a <a href="https://wiki.jenkins-ci.org/display/JENKINS/Groovy+Hook+Script">Groovy Hook Script</a>. 
If you are familiar with Linux init scripts, the idea is quite similar. </p>

<p>A Groovy script in the <code>$JENKINS_ROOT_DIR/init.groovy.d/</code> directory is executed during
Jenkins initialization. This way you can increase the global logger level with a script
as the following below.</p>

<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.logging.ConsoleHandler</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.logging.LogManager</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.logging.Logger</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">java.util.logging.Level</span>
&nbsp;
def logger <span style="color: #339933;">=</span> Logger.<span style="color: #006633;">getLogger</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;&quot;</span><span style="color: #009900;">&#41;</span>
logger.<span style="color: #006633;">setLevel</span><span style="color: #009900;">&#40;</span>Level.<span style="color: #006633;">FINEST</span><span style="color: #009900;">&#41;</span>
logger.<span style="color: #006633;">addHandler</span> <span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">new</span> ConsoleHandler<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span></pre>

<p>Happy logging!</p>

<p><!-- html -->
        <p class="postmetadata">
                <small>tags          [&nbsp;<a
            href="/tag/jenkins.html"
            rel="tag">jenkins</a>&nbsp;]&nbsp;
                 [&nbsp;<a
            href="/tag/groovy.html"
            rel="tag">groovy</a>&nbsp;]&nbsp;
                </small>
                        <br/>
        <small>posted in 
        [&nbsp;<a
            href="/blog.html"
            title="View all posts in blog"
            rel="category tag">blog</a>&nbsp;]&nbsp;
        category </small>
            </p>
</div>
<div class="ui raised padded text container segment">
    <h2>Treemapping Jenkins Extension Points with R</h2>
    <p><small>kinow</small> @ <small>May 19, 2014&nbsp;00:51:33</small></p>
    <div><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://kinoshita.eti.br/2014/05/19/treemapping-jenkins-extension-points-with-r.html" data-text="Treemapping Jenkins Extension Points with R" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>
    <p>I have been playing with R and its packages for some time, and decided to study it a 
bit harder. Last week I started reading the <a href="http://adv-r.had.co.nz/">Advanced R Programming</a> 
by Hadley Wickham. </p></p>

<p>One of the first chapters talks about the basic data structures in R. In order to 
get my feet wet I thought about a simple example: <a href="http://en.wikipedia.org/wiki/Treemapping">treemapping</a> 
Jenkins extension points. </p>

<p style="text-align: center;"><a href="/2014/05/19/treemapping-jenkins-extension-points-with-r/extension_points.png"><img src="/2014/05/19/treemapping-jenkins-extension-points-with-r/extension_points.png" width="600px" alt="Treemap graph" /></a></p>

<p>There is a <a href="https://wiki.jenkins-ci.org/display/JENKINS/Extension+points">Wiki page with the extension points in Jenkins</a> (what parts of Jenkins can be customized) 
and its implementations. That page is generated by a <a href="https://ci.jenkins-ci.org/view/Infrastructure/job/infra_extension-indexer/">Jenkins job</a>. </p>

<p>That job outputs a JSON file that contains each available extension points, as well as 
an array with its implementations. The R code below will produce two vectors, one with the 
count of implementations of each extension point, and the other with the class name.</p>

<pre class="r" style="font-family:monospace;">nExtensionPoints &lt;- length(extensionPointsJson$extensionPoints)
numberOfImplementations &lt;- vector(length = nExtensionPoints)
namesOfTheExtensionPoints &lt;- vector(length = nExtensionPoints)
for (i in seq_along(extensionPoints)) {
  extensionName = extensionPoints[[i]]$className
  lastIndexOfDot = regexpr(&quot;\\.[^\\.]*$&quot;, extensionName)
  namesOfTheExtensionPoints[[i]] = substr(extensionName, lastIndexOfDot[1]+1, nchar(extensionName))
  numberOfImplementations[[i]] = length(extensionPoints[[i]]$implementations)
  print(paste(namesOfTheExtensionPoints[[i]], &quot; -&gt; &quot;, numberOfImplementations[[i]]))
}</pre>

<p>For creating the treemap I used the <strong><a href="http://flowingdata.com/2010/02/11/an-easy-way-to-make-a-treemap/">portfolio package</a></strong>, and the <code>map.market</code> 
function. The structures previously created and the next snippet of code are all that is 
needed to create the treemap of the Jenkins extension points.</p>

<pre class="r" style="font-family:monospace;">map.market(id=seq_along(extensionPoints), area=numberOfImplementations, group=namesOfTheExtensionPoints, color=numberOfImplementations, main=&quot;Jenkins Extension Points&quot;)</pre>

<p>You can also use the <a href="https://wiki.jenkins-ci.org/display/JENKINS/R+Plugin">Jenkins R Plug-in</a> to produce this graph, 
as in this <a href="http://builds.tupilabs.com/job/backend-extension-points-treemap/2/">sample job</a>. 
You can get the complete script in this <a href="https://gist.github.com/kinow/d5a2221c32dce3aa1076">gist</a>, or just 
copy it here.</p>

<pre class="r" style="font-family:monospace;">library('rjson')
library('portfolio')
&nbsp;
download.file(url=&quot;https://ci.jenkins-ci.org/view/Infrastructure/job/infra_extension-indexer/ws/extension-points.json&quot;, destfile=&quot;extension-points.json&quot;, method=&quot;wget&quot;)
extensionPointsJson &lt;- fromJSON(paste(readLines(&quot;extension-points.json&quot;), collapse=&quot;&quot;))
extensionPoints &lt;- extensionPointsJson$extensionPoints
nExtensionPoints &lt;- length(extensionPointsJson$extensionPoints)
numberOfImplementations &lt;- vector(length = nExtensionPoints)
namesOfTheExtensionPoints &lt;- vector(length = nExtensionPoints)
for (i in seq_along(extensionPoints)) {
  extensionName = extensionPoints[[i]]$className
  lastIndexOfDot = regexpr(&quot;\\.[^\\.]*$&quot;, extensionName)
  namesOfTheExtensionPoints[[i]] = substr(extensionName, lastIndexOfDot[1]+1, nchar(extensionName))
  numberOfImplementations[[i]] = length(extensionPoints[[i]]$implementations)
  print(paste(namesOfTheExtensionPoints[[i]], &quot; -&gt; &quot;, numberOfImplementations[[i]]))
}
png(filename=&quot;extension-points.png&quot;, width=2048, height=1536, units=&quot;px&quot;, bg=&quot;white&quot;)
map.market(id=seq_along(extensionPoints), area=numberOfImplementations, group=namesOfTheExtensionPoints, color=numberOfImplementations, main=&quot;Jenkins Extension Points&quot;)
dev.off()</pre>

<p><!-- html -->
        <p class="postmetadata">
                <small>tags          [&nbsp;<a
            href="/tag/jenkins.html"
            rel="tag">jenkins</a>&nbsp;]&nbsp;
                 [&nbsp;<a
            href="/tag/r.html"
            rel="tag">r</a>&nbsp;]&nbsp;
                </small>
                        <br/>
        <small>posted in 
        [&nbsp;<a
            href="/blog.html"
            title="View all posts in blog"
            rel="category tag">blog</a>&nbsp;]&nbsp;
        category </small>
            </p>
</div></p>

<div id="navigation">
            &larr;&nbsp;<a href="/tag/jenkins/2.html" id="navigation-next">Older Entries</a>
        </div>

                    <p class="postmetadata">
                                                                    </p>
                                </div>
            </div>
        </div>
        <div class="ui vertical footer segment">
            <div class="ui center aligned container">
                           <div id="copy" class="">
                <p>&copy; <a href="http://kinoshita.eti.br/about"><span
                            class="b">Bru</span><span
                            class="r">no de</span> <span
                            class="a">Paula</span> <span
                            class="s"></span><span
                            class="i">Kinos</span><span
                            class="l">hita</span></a>
                </p>
            </div>
            </div>
         </div>
    </div>
</body>
</html>
<script src="http://kinoshita.eti.br/js/jquery-2.2.3.min.js"  type="text/javascript"></script>
    <script src="http://kinoshita.eti.br/css/semantic/dist/semantic.min.js"  type="text/javascript"></script>
    <script src="http://kinoshita.eti.br/js/jquery.prettyPhoto.js"></script>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function(){
    $("a[rel^='prettyPhoto']").prettyPhoto({
        social_tools: false,
        autoplay_slideshow: false, 
        hideflash: true, 
        autoplay: false, 
        overlay_gallery: false
    });

    $("#toc")
        .sidebar({
          dimPage          : true,
          transition       : 'overlay',
          mobileTransition : 'uncover'
        })
    ;

    $("#toc")
        .sidebar('attach events', '.launch.button, .view-ui, .launch.item')
    ;
  });
</script>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-32767310-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
