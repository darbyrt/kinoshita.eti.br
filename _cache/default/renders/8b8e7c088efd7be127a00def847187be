{"segments": {"content": "<p>I&#8217;ve always wanted to know how does the code to show what was I listening to looked like. I found it after installing XMPlay and XMPlay MSN Plug-in. The plug-in zip had the plug-in itself and its source code. And what a neat source code (-:.</p>\n<p>Basically, you just send a message to the MSN UI API with a defined data structure. And to remove the message, just send again with an empty string.</p>\n<div class=\"highlight\"><pre><span class=\"cm\">/*</span>\n<span class=\"cm\">Bruno de Paula Kinoshita</span>\n<span class=\"cm\">original src code:</span>\n<span class=\"cm\">XMPlay MSN Plugin (c) 2005-2006 Elliott Sales de Andrade</span>\n<span class=\"cm\">*/</span>\n\n<span class=\"cp\">#include &lt;cstdlib&gt;</span>\n<span class=\"cp\">#include &lt;iostream&gt;</span>\n<span class=\"cp\">#include &lt;windows.h&gt;</span>\n\n<span class=\"n\">using</span> <span class=\"n\">namespace</span> <span class=\"n\">std</span><span class=\"p\">;</span>\n\n<span class=\"k\">typedef</span> <span class=\"k\">struct</span> <span class=\"p\">{</span>\n<span class=\"n\">BOOL</span> <span class=\"n\">showCues</span><span class=\"p\">;</span>\n<span class=\"n\">BOOL</span> <span class=\"n\">keepOnClose</span><span class=\"p\">;</span>\n<span class=\"p\">}</span> <span class=\"n\">MSNStuff</span><span class=\"p\">;</span>\n<span class=\"k\">static</span> <span class=\"n\">MSNStuff</span> <span class=\"n\">msnConf</span><span class=\"p\">;</span>\n\n<span class=\"kt\">void</span> <span class=\"nf\">setNowPlaying</span><span class=\"p\">(</span> <span class=\"kt\">char</span> <span class=\"o\">*</span><span class=\"n\">title</span><span class=\"p\">)</span>\n<span class=\"p\">{</span>\n    <span class=\"kt\">wchar_t</span> <span class=\"o\">*</span><span class=\"n\">lpMsn</span><span class=\"p\">;</span>\n    <span class=\"kt\">int</span> <span class=\"n\">strLen</span> <span class=\"o\">=</span> <span class=\"mi\">20</span><span class=\"p\">;</span>\n    <span class=\"n\">HWND</span> <span class=\"n\">xmpwin</span><span class=\"p\">;</span>\n    <span class=\"n\">HWND</span> <span class=\"n\">msnui</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">;</span>\n\n    <span class=\"n\">lpMsn</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"kt\">wchar_t</span><span class=\"o\">*</span><span class=\"p\">)</span><span class=\"n\">calloc</span><span class=\"p\">(</span><span class=\"mi\">1024</span><span class=\"p\">,</span><span class=\"mi\">1024</span><span class=\"p\">);</span>\n    <span class=\"c1\">// stuff for MSN before...</span>\n    <span class=\"n\">memcpy</span><span class=\"p\">(</span><span class=\"n\">lpMsn</span><span class=\"p\">,</span> <span class=\"s\">L&quot;</span><span class=\"se\">\\\\</span><span class=\"s\">0Music</span><span class=\"se\">\\\\</span><span class=\"s\">01</span><span class=\"se\">\\\\</span><span class=\"s\">0{0}</span><span class=\"se\">\\\\</span><span class=\"s\">0&quot;</span><span class=\"p\">,</span> <span class=\"mi\">17</span><span class=\"o\">*</span><span class=\"mi\">2</span><span class=\"p\">);</span>\n    <span class=\"c1\">// actual title...</span>\n    <span class=\"n\">strLen</span><span class=\"o\">=</span><span class=\"n\">MultiByteToWideChar</span><span class=\"p\">(</span><span class=\"nb\">false</span><span class=\"o\">?</span><span class=\"nl\">CP_UTF8</span><span class=\"p\">:</span><span class=\"n\">CP_ACP</span><span class=\"p\">,</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"n\">title</span><span class=\"p\">,</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"n\">lpMsn</span><span class=\"o\">+</span><span class=\"mi\">17</span><span class=\"p\">,</span><span class=\"mi\">492</span><span class=\"p\">)</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">;</span><span class=\"err\">\u00c2</span>\u00a0 <span class=\"cm\">/* 1024/2 - 20 */</span>\n    <span class=\"c1\">// stuff for MSN after...</span>\n    <span class=\"n\">memcpy</span><span class=\"p\">(</span><span class=\"n\">lpMsn</span> <span class=\"o\">+</span> <span class=\"mi\">17</span> <span class=\"o\">+</span> <span class=\"n\">strLen</span><span class=\"p\">,</span> <span class=\"s\">L&quot;</span><span class=\"se\">\\\\</span><span class=\"s\">0&quot;</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"o\">*</span><span class=\"mi\">2</span><span class=\"p\">);</span>\n    <span class=\"n\">strLen</span> <span class=\"o\">+=</span> <span class=\"mi\">20</span><span class=\"p\">;</span>\n\n    <span class=\"n\">COPYDATASTRUCT</span> <span class=\"n\">msndata</span><span class=\"p\">;</span>\n    <span class=\"n\">msndata</span><span class=\"p\">.</span><span class=\"n\">dwData</span> <span class=\"o\">=</span> <span class=\"mh\">0x547</span><span class=\"p\">;</span>\n    <span class=\"n\">msndata</span><span class=\"p\">.</span><span class=\"n\">lpData</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"kt\">void</span><span class=\"o\">*</span><span class=\"p\">)</span><span class=\"n\">lpMsn</span><span class=\"p\">;</span>\n    <span class=\"n\">msndata</span><span class=\"p\">.</span><span class=\"n\">cbData</span> <span class=\"o\">=</span> <span class=\"n\">strLen</span> <span class=\"o\">*</span> <span class=\"mi\">2</span><span class=\"p\">;</span>\n\n    <span class=\"k\">while</span> <span class=\"p\">(</span> <span class=\"n\">msnui</span> <span class=\"o\">=</span> <span class=\"n\">FindWindowEx</span><span class=\"p\">(</span><span class=\"nb\">NULL</span><span class=\"p\">,</span> <span class=\"n\">msnui</span><span class=\"p\">,</span> <span class=\"s\">&quot;MsnMsgrUIManager&quot;</span><span class=\"p\">,</span> <span class=\"nb\">NULL</span><span class=\"p\">)</span> <span class=\"p\">)</span>\n        <span class=\"n\">SendMessage</span><span class=\"p\">(</span><span class=\"n\">msnui</span><span class=\"p\">,</span> <span class=\"n\">WM_COPYDATA</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"n\">WPARAM</span><span class=\"p\">)</span><span class=\"n\">xmpwin</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"n\">LPARAM</span><span class=\"p\">)</span><span class=\"o\">&amp;</span><span class=\"n\">msndata</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"kt\">int</span> <span class=\"nf\">main</span><span class=\"p\">(</span><span class=\"kt\">int</span> <span class=\"n\">argc</span><span class=\"p\">,</span> <span class=\"kt\">char</span> <span class=\"o\">*</span><span class=\"n\">argv</span><span class=\"p\">[])</span>\n<span class=\"p\">{</span>\n    <span class=\"kt\">char</span> <span class=\"o\">*</span><span class=\"n\">title</span><span class=\"p\">;</span>\n\n    <span class=\"k\">if</span> <span class=\"p\">(</span> <span class=\"n\">argc</span> <span class=\"o\">==</span> <span class=\"mi\">1</span> <span class=\"p\">)</span>\n        <span class=\"n\">title</span> <span class=\"o\">=</span> <span class=\"s\">&quot;&quot;</span><span class=\"p\">;</span>\n    <span class=\"k\">else</span>\n        <span class=\"n\">title</span> <span class=\"o\">=</span> <span class=\"n\">argv</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">];</span>\n\n    <span class=\"n\">setNowPlaying</span> <span class=\"p\">(</span> <span class=\"n\">title</span> <span class=\"p\">);</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">EXIT_SUCCESS</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</pre></div>"}, "pass_info": {"used_taxonomy_terms": [], "used_pagination": false, "pagination_has_more": false, "used_assets": false, "used_source_names": []}}