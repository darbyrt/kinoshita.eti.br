{"config": {"title": "Code to change your message in MSN messenger", "id": 100, "author": "kinow", "tags": ["c++"], "category": "blog", "time": "14:31:18", "format": null, "content_type": "html", "segments": ["content"]}, "content": {"content": [{"l": 9, "c": "I've always wanted to know how does the code to show what was I listening to looked like. I found it after installing XMPlay and XMPlay MSN Plug-in. The plug-in zip had the plug-in itself and its source code. And what a neat source code (-:.\n\nBasically, you just send a message to the MSN UI API with a defined data structure. And to remove the message, just send again with an empty string.\n\n{% geshi 'c'%}\n/*\nBruno de Paula Kinoshita\noriginal src code:\nXMPlay MSN Plugin (c) 2005-2006 Elliott Sales de Andrade\n*/\n\n#include <cstdlib>\n#include <iostream>\n#include <windows.h>\n\nusing namespace std;\n\ntypedef struct {\nBOOL showCues;\nBOOL keepOnClose;\n} MSNStuff;\nstatic MSNStuff msnConf;\n\nvoid setNowPlaying( char *title)\n{\n    wchar_t *lpMsn;\n    int strLen = 20;\n    HWND xmpwin;\n    HWND msnui=0;\n    \n    lpMsn = (wchar_t*)calloc(1024,1024);\n    // stuff for MSN before...\n    memcpy(lpMsn, L&quot;\\&#92;&#48;Music\\&#92;&#48;1\\&#92;&#48;{0}\\&#92;&#48;&quot;, 17*2);\n    // actual title...\n    strLen=MultiByteToWideChar(false?CP_UTF8:CP_ACP,0,title,-1,lpMsn+17,492)-1;\u00c2\u00a0 /* 1024/2 - 20 */\n    // stuff for MSN after...\n    memcpy(lpMsn + 17 + strLen, L&quot;\\&#92;&#48;&quot;, 3*2);\n    strLen += 20;\n    \n    COPYDATASTRUCT msndata;\n    msndata.dwData = 0x547;\n    msndata.lpData = (void*)lpMsn;\n    msndata.cbData = strLen * 2;\n    \n    while ( msnui = FindWindowEx(NULL, msnui, &quot;MsnMsgrUIManager&quot;, NULL) )\n        SendMessage(msnui, WM_COPYDATA, (WPARAM)xmpwin, (LPARAM)&amp;msndata);\n}\n\nint main(int argc, char *argv[])\n{\n    char *title;\n    \n    if ( argc == 1 )\n        title = &quot;&quot;;\n    else\n        title = argv[1];\n    \n    setNowPlaying ( title );\n    \n    return EXIT_SUCCESS;\n}{%endgeshi%}", "o": 135, "f": null}]}}