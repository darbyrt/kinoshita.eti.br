  <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
    <title>Bruno P. Kinoshita</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="Bruno de Paula Kinoshita personal web site" />
    <meta name="keywords"
        content="kinoshita, bruno de paula kinoshita, geek, geek stuff, java, python, c, c++, msn now playing, neural network, mackenzie, sao paulo, brasil, brazil, nerd, nerd stuff, cool, jenkins, illustration, quadrinhos, machine learning, linguistic, apache, open source, codigo livre, codigo aberto" />
    <meta name="author" content="Bruno P. Kinoshita" />
    <meta name="generator" content="PieCrust 1.2.0" />
    <meta name="template-engine" content="Twig" />
    <meta name="robots" content="all=index,follow" />
    <meta name="revisit-after" content="15 days" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta name="distribution" content="Global" />
    <meta name="url" content="http://kinoshita.eti.br/" />
    <meta name="copyright" content="Bruno de Paula Kinoshita" />
    <meta name="Googlebot" content="all" />
    <meta name="rating" content="general" />
    <meta http-equiv="expires" content="0" />
    <meta name="city" content="Sao Paulo" />
    <meta name="state" content="Brasil, Sao Paulo" />
    <meta http-equiv="content-language" content="en" />
    <meta http-equiv="imagetoolbar" content="no" />
    <meta id="page_favicon" href="http://kinoshita.eti.br/favicon.ico" rel="icon" type="image/x-icon" />
    <link rel="shortcut icon" type="image/x-icon" href="http://kinoshita.eti.br/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="alternate" type="application/rss+xml" title="Bruno P. Kinoshita &raquo; Feed" href="http://kinoshita.eti.br//feed.xml" />
    <link rel="stylesheet" href="http://kinoshita.eti.br/css/semantic/dist/semantic.min.css" type="text/css" media="screen, projection" />
    <link rel="stylesheet" href="http://kinoshita.eti.br/css/style.css" type="text/css" media="screen, projection" />
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/css/blueprint/ie.css" type="text/css" media="screen, projection" />
    <![endif]-->
    <link rel="stylesheet" href="http://kinoshita.eti.br/css/prettyPhoto.css" type="text/css" media="all" />
</head>
<body id="body">
    <div class="ui vertical sidebar menu" id="toc">
        <div class="menu">
    <div class="item">
        <a href="http://kinoshita.eti.br/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/software.html">Software</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/articles.html">Articles</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/books.html">Books</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/about.html">About &#038; CV</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/contact.html">Contact</a>
    </div>
</div>
<img id="me" src="http://kinoshita.eti.br/img/bruno.jpg" title="Hmmmm" alt="Hmmmm" width="134px" height="215px" />    </div>
    <div class="ui black big launch right attached fixed button">
        <i class="content icon"></i>
        <span class="text">Menu</span>
    </div>
    <div class="ui fixed inverted main menu">
        <div class="ui container">
            <a class="launch icon item">
                <i class="content icon"></i>
            </a>
            <div class="item">
                
            </div>
        </div>
    </div>
    <div class="pusher">
        <div class="full height">
            <div class="toc">
                <div class="ui vertical sticky fixed top menu">
                    <div class="menu">
    <div class="item">
        <a href="http://kinoshita.eti.br/" class="main-link">Kinoshita</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/software.html">Software</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/articles.html">Articles</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/books.html">Books</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/about.html">About &#038; CV</a>
    </div>
    <div class="item">
        <a href="http://kinoshita.eti.br/contact.html">Contact</a>
    </div>
</div>
<img id="me" src="http://kinoshita.eti.br/img/bruno.jpg" title="Hmmmm" alt="Hmmmm" width="134px" height="215px" />                </div>
            </div>
            <div class="article">
                <div class="main container">

                                                        <div class='ui padded text container'>
                        <h1 class='topic'>Blog</h1>
                    </div>
                                        <div class="ui raised padded text container segment">
                        <p>Posts in category &#8216;blog&#8217;</p>

<div class="post type-post status-publish format-standard hentry">
    <h2>Geek Vacation 2016</h2>
    <p><small>kinow</small> @ <small>April 8, 2016&nbsp;22:17:03</small></p>
    <div><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://kinoshita.eti.br/2016/04/08/geek-vacation-2016.html" data-text="Geek Vacation 2016" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>
    <p>I just had a two week vacation, and I tried to use my time to rest, play some music, and
complete a geek todo-list. </p>

<p>The list included things that I used some time ago but wanted to
refresh my memory, things that I already used but never spent time reading the manuals, and
other things that I saw somewhere but never actually used in any project.</p>

<p>Here the complete list, with the items that were completed highlighted. Some links with
pointers to what I used to study.</p>

<ul>
<li>gdb, strace, ptrace, etc, sysdig, dtrace (looked for links at <a href="https://news.ycombinator.com/">HackerNews</a> and <a href="https://www.reddit.com/">reddit</a>) ✔</li>
<li>geodesy (<a href="https://en.wikipedia.org/wiki/Geodesy">Wikipedia</a>, some PDF&#8217;s) ✔</li>
<li>QGIS (<a href="http://www.bostongis.com/?content_name=qgis">Boston GIS docs</a> and <a href="http://youtube.com">YouTube</a> videos) ✔</li>
<li>SRS &amp; CRS (<a href="https://en.wikipedia.org/wiki/Spatial_reference_system">Wikipedia</a>) ✔</li>
<li>BioPython (<a href="http://biopython.org/">project page</a>) ✔</li>
<li>BioConda (<a href="https://bioconda.github.io/">project page</a>) ✔</li>
<li>Weaver &amp; asm (<a href="https://commons.apache.org/proper/commons-weaver/">project page</a> and <a href="https://en.wikipedia.org/wiki/ObjectWeb_ASM">Wikipedia</a>) ✔</li>
<li>afl (project page, and some <a href="http://kinoshita.eti.br/2016/02/27/learning-afl-and-testing-mapserver.html">tests with MapServer</a>) ✔</li>
<li>WFS (<a href="https://en.wikipedia.org/wiki/Web_Feature_Service">Wikipedia</a>, <a href="http://docs.geoserver.org/latest/en/user/services/wfs/reference.html">GeoServer</a> and <a href="http://mapserver.org/ogc/wfs_server.html">MapServer</a>) ✔</li>
<li>SaltStack (<a href="http://saltstack.com/">project page</a>, <a href="https://wiki.jenkins-ci.org/display/JENKINS/saltstack-plugin">Jenkins Plug-ins for SaltStack</a>, and a few tests with VM&#8217;s and Docker) ✔</li>
<li>InfluxDB (<a href="https://influxdata.com/">project page</a>) ✔</li>
<li>rr (<a href="http://rr-project.org/">project page</a> and some local tests) ✔</li>
<li>ZeroMQ (<a href="http://zeromq.org/">project page</a>, <a href="https://github.com/saltstack/salt/blob/90b0a42a21dc11ca118ffbb679e0871f234c17bc/salt/transport/zeromq.py">SaltStack source code</a>) ✔</li>
<li>netty (<a href="http://netty.io/">project page</a>) ✔</li>
<li>RethinkDB (<a href="https://rethinkdb.com/">project page</a>, and a <a href="https://github.com/kinow/jira-rethinkdb">test project</a>) ✔</li>
<li>C++ (templates, abstractions in C++, etc) (<a href="http://www.codeproject.com/Articles/257589/An-Idiots-Guide-to-Cplusplus-Templates-Part">just this article to remember syntax</a>) ✔</li>
<li>Linear programming (<a href="http://benalexkeen.com/linear-programming-with-python-and-pulp/">PuLP docs</a>) ✔</li>
<li>AKKA (<a href="http://akka.io/">project page</a>) ✔</li>
<li>Frege (<a href="https://github.com/Frege/frege">project page</a> (reading their <a href="https://www.gitbook.com/book/dierk/fregegoodness/details">new book</a>))</li>
<li>JVM internals (played a little with <a href="http://asm.ow2.org/">asm</a>, <a href="http://docs.oracle.com/javase/7/docs/technotes/tools/windows/javap.html">javap</a>)</li>
<li>Java Concurrency (started re-reading <a href="http://jcip.net/">Java Concurrency in Practice</a>, but still in the initial chapters)</li>
<li>PostGIS (<a href="postgis.net/">project page</a>)</li>
<li>Krita (<a href="https://krita.org/">project page</a> and <a href="http://www.davidrevoy.com/article193/guide-building-krita-on-linux-for-cats">David Revoy&#8217;s tutorials</a>)</li>
<li>Scala (<a href="http://www.scala-lang.org/">project page</a>)</li>
<li>Minecraft Forge (<a href="http://www.minecraftforge.net/forum/">project forum</a>)</li>
<li>Graphs in Jenkins, cylc, Spark, Jena and clue/graph (didn&#8217;t have time for this one)</li>
</ul>

<p>Going to have less spare time now for Open Source and learning the rest of the stuff on this list,
but there&#8217;s always some books to read, and things to learn anyway right ¯&#92;<em>(ツ)</em>/¯</p>
<!-- html -->
        <p class="postmetadata">
                <small>tags          [&nbsp;<a
            href="/tag/geek.html"
            rel="tag">geek</a>&nbsp;]&nbsp;
                </small>
                        <br/>
        <small>posted in 
        [&nbsp;<a
            href="/blog.html"
            title="View all posts in blog"
            rel="category tag">blog</a>&nbsp;]&nbsp;
        category </small>
            </p>
</div>

<p><div class="post type-post status-publish format-standard hentry">
    <h2>Deploying WAR files to Tomcat with Jenkins</h2>
    <p><small>kinow</small> @ <small>March 20, 2016&nbsp;15:29:03</small></p>
    <div><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://kinoshita.eti.br/2016/03/20/deploying-war-files-to-tomcat-with-jenkins.html" data-text="Deploying WAR files to Tomcat with Jenkins" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>
    <p><strong>Table of Contents</strong></p></p>

<ul>
<li><a href="#1-deploying-with-custom-scripts">Deploying with custom scripts</a></li>
<li><a href="#2-deploying-with-a-build-tool">Deploying with a build tool</a></li>
<li><a href="#3-deploying-with-a-build-server">Deploying with a build server</a></li>
<li><a href="#final-thoughts">Final thoughts</a></li>
</ul>

<p>A co-worker asked me this week about how to deploy a WAR file to Tomcat with Jenkins. In my team we are
currently maintaining and deploying about 10 Java web systems, but we have no consistent way of deploying
the applications to Tomcat yet. In the past I used Ant, Maven, Cargo, Grunt, and Jenkins, so I
decided to write this short post to show a few different ways it can be achieved, &agrave; la
<a href="https://en.wikipedia.org/wiki/There's_more_than_one_way_to_do_it">Perl&#8217;s TMTOWTDI</a> motto.</p>

<h2><a name="1-deploying-with-custom-scripts" style="color: #222222;">#1 Deploying with custom scripts</a></h2>

<p>At first you may be tempted to write your own script to deploy to Tomcat with some Shell, Perl, Python
or Java. But I think I would choose this option only because either I needed some feature that is not
available in the other options, or in order to call other tasks or debug some problem.</p>

<p>Example:</p>

<pre class="bash" style="font-family:monospace;">$ docker run <span style="color: #660033;">-d</span> <span style="color: #660033;">-p</span> <span style="color: #000000;">8888</span>:<span style="color: #000000;">8080</span> jeanblanchard<span style="color: #000000; font-weight: bold;">/</span>tomcat:<span style="color: #000000;">8</span>
$ <span style="color: #c20cb9; font-weight: bold;">git clone</span> https:<span style="color: #000000; font-weight: bold;">//</span>github.com<span style="color: #000000; font-weight: bold;">/</span>spring-projects<span style="color: #000000; font-weight: bold;">/</span>spring-petclinic.git <span style="color: #000000; font-weight: bold;">&amp;&amp;</span> <span style="color: #7a0874; font-weight: bold;">cd</span> spring-petclinic <span style="color: #000000; font-weight: bold;">&amp;&amp;</span> mvn package
$ curl <span style="color: #660033;">--upload-file</span> target<span style="color: #000000; font-weight: bold;">/</span>petclinic.war <span style="color: #ff0000;">&quot;http://admin:admin@localhost:8888/manager/text/deploy?path=/spring-petclinic&amp;update=true&quot;</span>
OK - Deployed application at context path <span style="color: #000000; font-weight: bold;">/</span>spring-petclinic</pre>

<p><!-- html -->
        <p>( <a href="/2016/03/20/deploying-war-files-to-tomcat-with-jenkins.html" >Read more &#8230;</a> )</p>
        <p class="postmetadata">
                <small>tags          [&nbsp;<a
            href="/tag/jenkins.html"
            rel="tag">jenkins</a>&nbsp;]&nbsp;
                 [&nbsp;<a
            href="/tag/tomcat.html"
            rel="tag">tomcat</a>&nbsp;]&nbsp;
                 [&nbsp;<a
            href="/tag/docker.html"
            rel="tag">docker</a>&nbsp;]&nbsp;
                </small>
                        <br/>
        <small>posted in 
        [&nbsp;<a
            href="/blog.html"
            title="View all posts in blog"
            rel="category tag">blog</a>&nbsp;]&nbsp;
        category </small>
            </p>
</div>
<div class="post type-post status-publish format-standard hentry">
    <h2>Drawing sketch: Cheese</h2>
    <p><small>kinow</small> @ <small>March 20, 2016&nbsp;11:13:03</small></p>
    <div><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://kinoshita.eti.br/2016/03/20/drawing-sketch-cheese.html" data-text="Drawing sketch: Cheese" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>
    <div class='row'>
<div class="ui container" style='text-align: center;'>
<figure>
<a href="/2016/03/20/drawing-sketch-cheese/cheese.png" rel="prettyPhoto" class="thumbnail" title="Cheese">
<img class="ui fluid image" src="/2016/03/20/drawing-sketch-cheese/cheese.png" alt="Cheese" />
</a>
<figcaption>Cheese</figcaption>
</figure>
</div>
</div></p>

<p>For <a href="https://www.reddit.com/r/redditgetsdrawn/comments/42izou/this_is_me_with_my_favourite_food_its_cheese/">redditgetsdrawn</a></p>

<p><!-- html -->
        <p class="postmetadata">
                <small>tags          [&nbsp;<a
            href="/tag/drawing.html"
            rel="tag">drawing</a>&nbsp;]&nbsp;
                 [&nbsp;<a
            href="/tag/sketch.html"
            rel="tag">sketch</a>&nbsp;]&nbsp;
                </small>
                        <br/>
        <small>posted in 
        [&nbsp;<a
            href="/blog.html"
            title="View all posts in blog"
            rel="category tag">blog</a>&nbsp;]&nbsp;
        category </small>
            </p>
</div>
<div class="post type-post status-publish format-standard hentry">
    <h2>Learning afl and testing MapServer</h2>
    <p><small>kinow</small> @ <small>February 27, 2016&nbsp;23:21:03</small></p>
    <div><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://kinoshita.eti.br/2016/02/27/learning-afl-and-testing-mapserver.html" data-text="Learning afl and testing MapServer" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>
    <p><a href="http://lcamtuf.coredump.cx/afl/">afl</a> is a fuzzer, an application that combines a series of algorithms
in order to try invoking programs with several different input values. It then analyses the application
execution flow given different test case scenarios. 
You can read more about fuzzing at <a href="https://www.owasp.org/index.php/Fuzzing">this OWASP page</a>, or in other
blogs that I also used while learning about afl
<a href="/2016/02/27/using-afl-to-test-mapserver#1.html">1</a>
<a href="/2016/02/27/using-afl-to-test-mapserver#2.html">2</a></p></p>

<p>At work we are using MapServer for serving WFS and WMS. And I am using it for the
<a href="http://maps.nzoss.org.nz">NZ OpenStreetMap maps</a> too. MapServer is written in C++ and is normally
exposed as a CGI script, so I thought it was worth learning about afl and trying it on MapServer,
as in case it finds any interesting bug I can submit it to the MapServer project.</p>

<p><!-- html -->
        <p>( <a href="/2016/02/27/learning-afl-and-testing-mapserver.html" >Read more &#8230;</a> )</p>
        <p class="postmetadata">
                <small>tags          [&nbsp;<a
            href="/tag/mapserver.html"
            rel="tag">mapserver</a>&nbsp;]&nbsp;
                 [&nbsp;<a
            href="/tag/afl.html"
            rel="tag">afl</a>&nbsp;]&nbsp;
                 [&nbsp;<a
            href="/tag/fuzz-testing.html"
            rel="tag">fuzz testing</a>&nbsp;]&nbsp;
                 [&nbsp;<a
            href="/tag/security.html"
            rel="tag">security</a>&nbsp;]&nbsp;
                 [&nbsp;<a
            href="/tag/testing.html"
            rel="tag">testing</a>&nbsp;]&nbsp;
                </small>
                        <br/>
        <small>posted in 
        [&nbsp;<a
            href="/blog.html"
            title="View all posts in blog"
            rel="category tag">blog</a>&nbsp;]&nbsp;
        category </small>
            </p>
</div>
<div class="post type-post status-publish format-standard hentry">
    <h2>How does the Jenkins Credentials Plug-in store passwords?</h2>
    <p><small>kinow</small> @ <small>September 7, 2015&nbsp;01:25:03</small></p>
    <div><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://kinoshita.eti.br/2015/09/07/how_does_the_jenkins_credentials_plugin_store_passwords.html" data-text="How does the Jenkins Credentials Plug-in store passwords?" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>
    <p><a href="https://wiki.jenkins-ci.org/display/JENKINS/Credentials+Plugin">Jenkins Credentials Plug-in</a> manages credentials stored in Jenkins. These credentials can be used in many jobs and by plug-ins for executing SSH commands, authenticating to systems, or running other commands that need some sort of authentication or authorisation.</p></p>

<p>I recently used its API for the first time in the <a href="https://github.com/biouno/figshare-plugin">BioUno figshare Plug-in</a> to store OAuth 1.0 credentials (consumer key, consumer secret, token key, token secret). This <a href="http://biouno.org/2015/09/05/using_jenkins_credentials_plugin_to_create_the_biouno_figshare_plugin/">blog post</a> has more details about how we used the plug-in, but this post is specifically on how the passwords are stored by Jenkins.</p>

<h2>Secret and ciphers</h2>

<p>Jenkins stores its configuration on disk as XML using the XStream library. Plug-in developers using the Credentials Plug-in API must use the <strong>Secret</strong> class to encrypt sensitive information.</p>

<p>The <code>Secret.fromString</code> method is responsible for creating a cipher from a given String. As in the Secret Javadoc,  <em>&#8220;this is not meant as a protection against code running in the same VM, nor against an attacker who has local file system access on Jenkins master&#8221;</em>. But at least makes things more complicated :-)</p>

<ul>
<li><a href="http://javadoc.jenkins-ci.org/hudson/util/Secret.html">Secret Javadoc</a></li>
<li><a href="https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/hudson/util/Secret.java">Secret source code</a></li>
</ul>

<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> Secret fromString<span style="color: #009900;">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span style="color: #003399;">String</span></a> data<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    data <span style="color: #339933;">=</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+util"><span style="color: #003399;">Util</span></a>.<span style="color: #006633;">fixNull</span><span style="color: #009900;">&#40;</span>data<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    Secret s <span style="color: #339933;">=</span> decrypt<span style="color: #009900;">&#40;</span>data<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #000000; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span>s<span style="color: #339933;">==</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> s<span style="color: #339933;">=</span><span style="color: #000000; font-weight: bold;">new</span> Secret<span style="color: #009900;">&#40;</span>data<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #000000; font-weight: bold;">return</span> s<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre>

<p>The first line simply replaces a null string by an empty &#8220;&#8221;, or keeps the current value of not null.</p>

<p>After that, the decrypt method is called.</p>

<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">static</span> Secret decrypt<span style="color: #009900;">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span style="color: #003399;">String</span></a> data<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #000000; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span>data<span style="color: #339933;">==</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span>      <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
    <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #000066; font-weight: bold;">byte</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> in <span style="color: #339933;">=</span> Base64.<span style="color: #006633;">decode</span><span style="color: #009900;">&#40;</span>data.<span style="color: #006633;">toCharArray</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        Secret s <span style="color: #339933;">=</span> tryDecrypt<span style="color: #009900;">&#40;</span>KEY.<span style="color: #006633;">decrypt</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, in<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>s<span style="color: #339933;">!=</span><span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span>    <span style="color: #000000; font-weight: bold;">return</span> s<span style="color: #339933;">;</span>
&nbsp;
        <span style="color: #666666; font-style: italic;">// try our historical key for backward compatibility</span>
        Cipher cipher <span style="color: #339933;">=</span> getCipher<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;AES&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        cipher.<span style="color: #006633;">init</span><span style="color: #009900;">&#40;</span>Cipher.<span style="color: #006633;">DECRYPT_MODE</span>, getLegacyKey<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #000000; font-weight: bold;">return</span> tryDecrypt<span style="color: #009900;">&#40;</span>cipher, in<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+generalsecurityexception"><span style="color: #003399;">GeneralSecurityException</span></a> e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+unsupportedencodingexception"><span style="color: #003399;">UnsupportedEncodingException</span></a> e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">throw</span> <span style="color: #000000; font-weight: bold;">new</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+error"><span style="color: #003399;">Error</span></a><span style="color: #009900;">&#40;</span>e<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// impossible</span>
    <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+ioexception"><span style="color: #003399;">IOException</span></a> e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span></pre>

<p>The <code>KEY.decrypt()</code> call will return a <a href="http://docs.oracle.com/javase/8/docs/api/javax/crypto/Cipher.html"><code>javax.crypto.Cipher</code></a>. The Cipher class is handled in <a href="https://github.com/jenkinsci/jenkins/blob/93dfe3377ec8d430818f5b9073f16c677343adb4/core/src/main/java/jenkins/security/CryptoConfidentialKey.java">CryptoConfidentialKey</a> in Jenkins API, where it defines the algorithm used to create the cipher: <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a>.</p>

<p>Jenkins has also a <a href="https://github.com/jenkinsci/jenkins/blob/93dfe3377ec8d430818f5b9073f16c677343adb4/core/src/main/java/jenkins/security/ConfidentialStore.java#L63">ConfidentialStore</a>, that is required to create the cipher. This class must be initialized before someone tries to create or read a cipher. This extra step also increases security, though access to the JVM is still a problem.</p>

<p>It is a bit late, so it is all for today. In summary: the credentials plug-in gives you a central place to manage credentials, but it is up to plug-in developers to use it. Sensitive values can be encrypted with AES on disk. So it is important that your file permissions, ACL and system auditing processes are in place and well maintained and monitored.</p>

<p>Happy hacking!</p>

<p><!-- html -->
        <p class="postmetadata">
                <small>tags          [&nbsp;<a
            href="/tag/jenkins.html"
            rel="tag">jenkins</a>&nbsp;]&nbsp;
                 [&nbsp;<a
            href="/tag/plugin.html"
            rel="tag">plugin</a>&nbsp;]&nbsp;
                 [&nbsp;<a
            href="/tag/security.html"
            rel="tag">security</a>&nbsp;]&nbsp;
                </small>
                        <br/>
        <small>posted in 
        [&nbsp;<a
            href="/blog.html"
            title="View all posts in blog"
            rel="category tag">blog</a>&nbsp;]&nbsp;
        category </small>
            </p>
</div></p>

                    </div>
                    <p class="postmetadata">
                                                                    </p>
                                </div>
            </div>
        </div>
        <div class="ui vertical footer segment">
            <div class="ui center aligned container">
                           <div id="copy" class="">
                <p>&copy; <a href="http://kinoshita.eti.br/about"><span
                            class="b">Bru</span><span
                            class="r">no de</span> <span
                            class="a">Paula</span> <span
                            class="s"></span><span
                            class="i">Kinos</span><span
                            class="l">hita</span></a>
                </p>
            </div>
            </div>
         </div>
    </div>
</body>
</html>
<script src="http://kinoshita.eti.br/js/jquery-2.2.3.min.js"  type="text/javascript"></script>
    <script src="http://kinoshita.eti.br/css/semantic/dist/semantic.min.js"  type="text/javascript"></script>
    <script src="http://kinoshita.eti.br/js/jquery.prettyPhoto.js"></script>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function(){
    $("a[rel^='prettyPhoto']").prettyPhoto({
        social_tools: false,
        autoplay_slideshow: false, 
        hideflash: true, 
        autoplay: false, 
        overlay_gallery: false
    });

    $("#toc")
        .sidebar({
          dimPage          : true,
          transition       : 'overlay',
          mobileTransition : 'uncover'
        })
    ;

    $("#toc")
        .sidebar('attach events', '.launch.button, .view-ui, .launch.item')
    ;
  });
</script>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-32767310-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
