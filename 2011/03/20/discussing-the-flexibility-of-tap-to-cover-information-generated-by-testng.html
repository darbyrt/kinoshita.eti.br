  <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
<title>Bruno P. Kinoshita &mdash; Discussing the flexibility of TAP to cover information generated by TestNG</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="description" content="Bruno de Paula Kinoshita personal web site" />
<meta name="keywords"
    content="kinoshita, bruno de paula kinoshita, geek, geek stuff, java, python, c, c++, msn now playing, neural network, mackenzie, sao paulo, brasil, brazil, nerd, nerd stuff, cool, jenkins, illustration, quadrinhos, machine learning, linguistic, apache" />
<meta name="author" content="Bruno P. Kinoshita" />
<meta name="generator" content="PieCrust 1.2.0" />
<meta name="template-engine" content="Twig" />
<meta name="robots" content="all=index,follow" />
<meta name="revisit-after" content="15 days" />
<meta http-equiv="Pragma" content="no-cache" />
<meta name="distribution" content="Global" />
<meta name="url" content="http://kinoshita.eti.br/" />
<meta name="copyright" content="Bruno de Paula Kinoshita" />
<meta name="Googlebot" content="all" />
<meta name="rating" content="general" />
<meta http-equiv="expires" content="0" />
<meta name="city" content="Sao Paulo" />
<meta name="state" content="Brasil, Sao Paulo" />
<meta http-equiv="content-language" content="en" />
<meta http-equiv="imagetoolbar" content="no" />
<meta id="page_favicon" href="http://kinoshita.eti.br/favicon.ico" rel="icon" type="image/x-icon" />
<link rel="shortcut icon" type="image/x-icon" href="http://kinoshita.eti.br/favicon.ico">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1">
<!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<script src="http://kinoshita.eti.br/js/jquery-1.6.1.min.js"  type="text/javascript" charset="utf-8"></script>
<script src="http://kinoshita.eti.br/js/jquery.prettyPhoto.js"></script>
<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<link rel="alternate" type="application/rss+xml" title="Bruno P. Kinoshita &raquo; Feed" href="http://kinoshita.eti.br//feed.xml" />
<link rel="stylesheet" href="http://kinoshita.eti.br/css/prettyPhoto.css" type="text/css" media="screen, projection" />
<link rel="stylesheet" href="http://kinoshita.eti.br/css/bootstrap.css" type="text/css" media="screen, projection" />
<link rel="stylesheet" href="http://kinoshita.eti.br/css/bootstrap-responsive.css" type="text/css" media="screen, projection" />
<link rel="stylesheet" href="http://kinoshita.eti.br/css/style.css" type="text/css" media="screen, projection" />
<!--[if lt IE 8]>
    <link rel="stylesheet" href="/css/blueprint/ie.css" type="text/css" media="screen, projection" />
<![endif]-->
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Sans">
 <link rel="stylesheet" href="/css/default.css" type="text/css" media="all" />
 
</head>
<body class="home blog">
    <div class="container-fluid">
            <div class="row-fluid">
            <div id="left" class="span2">
                <div style="padding-top: 6px;">
                    <ul>
                        <li><a style="color: #E13F4D;" class="mainlink"
                            href="http://kinoshita.eti.br/">Kinoshita</a></li>
                    </ul>
                </div>
                <div class="menu-main-menu-container">
    <ul
        id="menu-main-menu"
        class="menu">
        <li
            class="menu-item"><a
            href="http://kinoshita.eti.br/software.html">Software</a></li>
        <li
            class="menu-item"><a
            href="http://kinoshita.eti.br/articles.html">Articles</a></li>
        <li
            class="menu-item"><a
            href="http://kinoshita.eti.br/books.html">Books</a></li>
        <li
            class="menu-item"><a
            href="http://kinoshita.eti.br/about.html">About &#038; CV</a></li>
        <li
            class="menu-item"><a
            href="http://kinoshita.eti.br/contact.html">Contact</a></li>
    </ul>
</div>                <hr class="space" />
                <img src="http://kinoshita.eti.br/img/bruno.jpg"
                    title="Hmmmm" alt="Hmmmm" width="134px" height="215px" />
                <hr class="space" />
                            </div>
                        <div id="right" class="span8">
                <div id="main">
                <div class="post type-post status-publish format-standard hentry">
    <h1 class='post-topic'>Discussing the flexibility of TAP to cover information generated by TestNG</h1>
    <small>Bruno P. Kinoshita</small> @
	<small>March 20, 2011&nbsp;03:34:05</small>
    <div class="entry">
       <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://kinoshita.eti.br/2011/03/20/discussing-the-flexibility-of-tap-to-cover-information-generated-by-testng.html" data-text="Discussing the flexibility of TAP to cover information generated by TestNG" data-via="kinow" data-hashtags="opensource">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

	   <p>In today&#8217;s post I am expanding the previous one regarding the use of <a title="TAP (Test Anything Protocol)" href="http://www.testanything.org">TAP</a> with <a title="TestNG" href="http://www.testng.org">TestNG</a>. Let&#8217;s discuss about the flexibility of TAP to cover information generated by TestNG, more specifically:</p>

<ul>
    <li>Expected Exceptions</li>
    <li>Data Providers</li>
    <li>Groups</li>
    <li>Tests that get skipped</li>
    <li>Dependencies</li>
</ul>

<p>We will be addressing these bullet points using <a title="tap4j" href="http://tap4j.sourceforge.net">tap4j</a>, a TAP implementation for Java. The integration between TAP and TestNG is done through the use of TestNG Listeners developed in tap4j project (a big thanks here to <a title="Cesar Fernandes de Almeida" href="http://www.cesinha.com">Cesar Fernandes de Almeida</a> for all his help).</p>

<p>There are two listeners in tap4j, <a title="br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter" href="https://github.com/kinow/tap4j/blob/master/src/main/java/org/tap4j/ext/testng/TestTAPReporter.java">br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter</a> and <a title="br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter" href="https://github.com/kinow/tap4j/blob/master/src/main/java/br/eti/kinoshita/tap4j/ext/testng/SuiteTAPReporter.java">br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter</a>. The first was created based on <a title="org.testng.reporters.TestHTMLReporter" href="https://github.com/cbeust/testng/blob/master/src/main/java/org/testng/reporters/TestHTMLReporter.java">org.testng.reporters.TestHTMLReporter</a> and the latter was created based on <a title="org.testng.reporters.SuiteHTMLReporter" href="https://github.com/cbeust/testng/blob/master/src/main/java/org/testng/reporters/SuiteHTMLReporter.java">org.testng.reporters.SuiteHTMLReporter</a>.</p>

<p style="text-align: center;"><a href="/2011/03/20/discussing-the-flexibility-of-tap-to-cover-information-generated-by-testng/unnamed0.jpg"><img class="alignnone" title="Testing Tools as producers, TAP and consumers" src="/2011/03/20/discussing-the-flexibility-of-tap-to-cover-information-generated-by-testng/unnamed0.jpg" alt="" width="553" height="474" /></a></p>

<p style="text-align: center;"><em><span style="color: #999999; font-size: 0.8em;">In this figure you have testing tools as TAP producers (left) and different types of applications as consumers (right)</span></em></p>

<!--more-->

<h2>Expected Exceptions</h2>

<p>There is no special treatment for the Expected Exceptions in the tap4j Listeners. When a test passes, tap4j listeners logs only that the test succeeded. But when it fails and the Test Result contains a Throwable object, it is logged to the TAP Stream. I am still discussing it with Cesar whether it would be a good idea to parse the Throwable message body to retrieve the &#8216;line&#8217;, &#8216;expected&#8217; and &#8216;got&#8217; values for this error (these are entries in TAP Diagnostics - YAML).</p>

<p>Particularly, I would like to have this information in TestException. Maybe it could have a constructor public TestException(String message, Throwable t, String expected, String got, long lineNumber) and TestNG could fill this information for me :-). I know I&#8217;m being lazy, but I like the description of laziness in <a title="Larry Wall's Wikipedia entry" href="http://en.wikipedia.org/wiki/Larry_Wall">Larry Wall&#8217;s WikiPedia entry</a>. The following test is expecting an exception that is never thrown, thus it raises an exception.</p>

<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">package</span> <span style="color: #006699;">example1</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.testng.Assert</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.testng.annotations.Test</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> TestFoo
<span style="color: #009900;">&#123;</span>
&nbsp;
 <span style="color: #666666; font-style: italic;">// expecing npe instead of arith.</span>
 @Test<span style="color: #009900;">&#40;</span>expectedExceptions<span style="color: #339933;">=</span><span style="color: #009900;">&#123;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+nullpointerexception"><span style="color: #003399;">NullPointerException</span></a>.<span style="color: #000000; font-weight: bold;">class</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>
 <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> test<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
 <span style="color: #009900;">&#123;</span>
   <span style="color: #000000; font-weight: bold;">Assert</span>.<span style="color: #006633;">assertTrue</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">/</span><span style="color: #cc66cc;">0</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// programmatic causing an error in the test</span>
 <span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #009900;">&#125;</span></pre>

<p>And the TAP Stream with the exception in the &#8216;backtrace&#8217; entry.</p>

<pre class="tap" style="font-family:monospace;">1..1
not ok 1 - example1.TestFoo#test
 ---
 message: TestNG Test test
 severity: High
 source: example1.TestFoo#test
 datetime: '2011-03-20T03:45:30'
 file: example1.TestFoo
 line: ''
 name: test
 extensions: '~'
 got: '~'
 expected: '~'
 display: '~'
 dump: '~'
 error: &amp;quot;\nExpected exception java.lang.NullPointerException but got org.testng.TestException:\
 \ \nExpected exception java.lang.NullPointerException but got java.lang.ArithmeticException:\
 \ / by zero&amp;quot;
 backtrace: &amp;quot;org.testng.TestException: \nExpected exception java.lang.NullPointerException\
 \ but got org.testng.TestException: \nExpected exception java.lang.NullPointerException\
 \ but got java.lang.ArithmeticException: / by zero\n\tat org.testng.internal.Invoker.handleInvocationResults(Invoker.java:1416)\n\
 \tat org.testng.internal.Invoker.invokeTestMethods(Invoker.java:1184)\n\tat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:125)\n\
 \tat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:109)\n\tat org.testng.TestRunner.runWorkers(TestRunner.java:1125)\n\
 \tat org.testng.TestRunner.privateRun(TestRunner.java:749)\n\tat org.testng.TestRunner.run(TestRunner.java:600)\n\
 \tat org.testng.SuiteRunner.runTest(SuiteRunner.java:317)\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:312)\n\
 \tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:274)\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:223)\n\
 \tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:86)\n\
 \tat org.testng.TestNG.runSuitesSequentially(TestNG.java:995)\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:920)\n\
 \tat org.testng.TestNG.run(TestNG.java:856)\n\tat org.testng.remote.RemoteTestNG.run(RemoteTestNG.java:110)\n\
 \tat org.testng.remote.RemoteTestNG.initAndRun(RemoteTestNG.java:205)\n\tat org.testng.remote.RemoteTestNG.main(RemoteTestNG.java:174)\n\
 Caused by: org.testng.TestException: \nExpected exception java.lang.NullPointerException\
 \ but got java.lang.ArithmeticException: / by zero\n\tat org.testng.internal.Invoker.handleInvocationResults(Invoker.java:1416)\n\
 \tat org.testng.internal.Invoker.invokeMethod(Invoker.java:722)\n\tat org.testng.internal.Invoker.invokeTestMethod(Invoker.java:846)\n\
 \tat org.testng.internal.Invoker.invokeTestMethods(Invoker.java:1170)\n\t... 17\
 \ more\nCaused by: java.lang.ArithmeticException: / by zero\n\tat example1.TestFoo.test(TestFoo.java:17)\n\
 \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\
 \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\
 \tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:74)\n\
 \tat org.testng.internal.Invoker.invokeMethod(Invoker.java:673)\n\t... 19 more\n&amp;quot;
 ...</pre>

<p>As you can see, the Exception contains the information of what the test expected (java.lang.NullPointerException) and what the test actually got (java.lang.ArithmeticException).</p>

<h2>Data Providers</h2>

<p>In order to use a data provider with TestNG you have to add parameters to your method. Look at the code below.</p>

<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">package</span> <span style="color: #006699;">example1</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.testng.Assert</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.testng.annotations.DataProvider</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.testng.annotations.Listeners</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.testng.annotations.Test</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter</span><span style="color: #339933;">;</span>
&nbsp;
@Listeners<span style="color: #009900;">&#40;</span>value<span style="color: #339933;">=</span><span style="color: #009900;">&#123;</span>TestTAPReporter.<span style="color: #000000; font-weight: bold;">class</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> TestWithDataProvider
<span style="color: #009900;">&#123;</span>
&nbsp;
 @DataProvider<span style="color: #009900;">&#40;</span>name<span style="color: #339933;">=&amp;</span>quot<span style="color: #339933;">;</span>names<span style="color: #339933;">&amp;</span>quot<span style="color: #339933;">;</span><span style="color: #009900;">&#41;</span>
 <span style="color: #000000; font-weight: bold;">public</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+object"><span style="color: #003399;">Object</span></a><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> getNames<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
 <span style="color: #009900;">&#123;</span>
   <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000000; font-weight: bold;">new</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+object"><span style="color: #003399;">Object</span></a><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span>
   <span style="color: #009900;">&#123;</span>
     <span style="color: #009900;">&#123;</span><span style="color: #339933;">&amp;</span>quot<span style="color: #339933;">;</span>Haruki<span style="color: #339933;">&amp;</span>quot<span style="color: #339933;">;</span><span style="color: #009900;">&#125;</span>,
     <span style="color: #009900;">&#123;</span><span style="color: #339933;">&amp;</span>quot<span style="color: #339933;">;</span>Murakami<span style="color: #339933;">&amp;</span>quot<span style="color: #339933;">;</span><span style="color: #009900;">&#125;</span>
   <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
 <span style="color: #009900;">&#125;</span>
&nbsp;
 @Test<span style="color: #009900;">&#40;</span>dataProvider<span style="color: #339933;">=&amp;</span>quot<span style="color: #339933;">;</span>names<span style="color: #339933;">&amp;</span>quot<span style="color: #339933;">;</span><span style="color: #009900;">&#41;</span>
 <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testName<span style="color: #009900;">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span style="color: #003399;">String</span></a> name<span style="color: #009900;">&#41;</span>
 <span style="color: #009900;">&#123;</span>
   <span style="color: #000000; font-weight: bold;">Assert</span>.<span style="color: #006633;">assertNotNull</span><span style="color: #009900;">&#40;</span>name<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
 <span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #009900;">&#125;</span></pre>

<p>Running the test above results in the following TAP Stream:</p>

<pre class="tap" style="font-family:monospace;">1..2
ok 1 - example1.TestWithDataProvider#testName
 ---
 message: TestNG Test testName
 severity: '~'
 source: example1.TestWithDataProvider#testName
 datetime: '2011-03-20T03:09:50'
 file: example1.TestWithDataProvider
 line: '~'
 name: testName
 extensions: '~'
 got: '~'
 expected: '~'
 display: '~'
 dump: '{param1=Haruki}'
 error: '~'
 backtrace: '~'
 ...
ok 2 - example1.TestWithDataProvider#testName
 ---
 message: TestNG Test testName
 severity: '~'
 source: example1.TestWithDataProvider#testName
 datetime: '2011-03-20T03:09:50'
 file: example1.TestWithDataProvider
 line: '~'
 name: testName
 extensions: '~'
 got: '~'
 expected: '~'
 display: '~'
 dump: '{param1=Murakami}'
 error: '~'
 backtrace: '~'
 ...</pre>

<p>As you can see, tap4j listeners output in the &#8216;dump&#8217; entry the values for parameters used in the test. This way you have both the data obtained through Data Providers and what was passed as parameters during the test execution. One issue could be that this information can&#8217;t be distinguished, i.e. you can&#8217;t tell if the params are coming from a Data Provider or if they are parameters.</p>

<h2>Groups</h2>

<p>The listener <a title="br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter" href="https://github.com/kinow/tap4j/blob/master/src/main/java/org/tap4j/ext/testng/SuiteTAPReporter.java">br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter</a> contains the logic to generate a TAP Stream for each TestNG group found in the test suite. There was a BUG in this listener that was fixed in tap4j version 1.4.5 (thanks again to Cesar). Let&#8217;s use the following code taken from TestNG documentation site.</p>

<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">package</span> <span style="color: #006699;">example1</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.testng.annotations.BeforeClass</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.testng.annotations.Test</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> SimpleTest <span style="color: #009900;">&#123;</span>
&nbsp;
@BeforeClass
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setUp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #666666; font-style: italic;">// code that will be invoked when this test is instantiated</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
@Test<span style="color: #009900;">&#40;</span>groups <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span> <span style="color: #339933;">&amp;</span>quot<span style="color: #339933;">;</span>fast<span style="color: #339933;">&amp;</span>quot<span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> aFastTest<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+system"><span style="color: #003399;">System</span></a>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">&amp;</span>quot<span style="color: #339933;">;</span>Fast test<span style="color: #339933;">&amp;</span>quot<span style="color: #339933;">;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
@Test<span style="color: #009900;">&#40;</span>groups <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span> <span style="color: #339933;">&amp;</span>quot<span style="color: #339933;">;</span>slow<span style="color: #339933;">&amp;</span>quot<span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> aSlowTest<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+system"><span style="color: #003399;">System</span></a>.<span style="color: #006633;">out</span>.<span style="color: #006633;">println</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">&amp;</span>quot<span style="color: #339933;">;</span>Slow test<span style="color: #339933;">&amp;</span>quot<span style="color: #339933;">;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #009900;">&#125;</span></pre>

<p>And let&#8217;s create a XML suite for running this test with tap4j SuiteTAPReporter listener.</p>

<pre class="xml" style="font-family:monospace;"><span style="color: #00bbdd;">&lt;!DOCTYPE suite SYSTEM &amp;quot;http://testng.org/testng-1.0.dtd&amp;quot; &gt;</span>
&nbsp;
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;suite</span> <span style="color: #000066;">name</span>=&amp;quot;ExampleSuite&amp;quot; <span style="color: #000066;">verbose</span>=&amp;quot;1&amp;quot; <span style="color: #000000; font-weight: bold;">&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;listeners<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;listener</span> <span style="color: #000066;">class-name</span>=&amp;quot;br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter&amp;quot; <span style="color: #000000; font-weight: bold;">/&gt;</span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/listener<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;test</span> <span style="color: #000066;">name</span>=&amp;quot;Sample test&amp;quot;<span style="color: #000000; font-weight: bold;">&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;classes<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;class</span> <span style="color: #000066;">name</span>=&amp;quot;example1.SimpleTest&amp;quot; <span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/classes<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/test<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/suite<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>

<p>Running this XML suite will produce three files in the test-output directory.</p>

<p><pre><span style="text-decoration: underline;">ExampleSuite.tap</span></pre></p>

<pre class="tap" style="font-family:monospace;">1..2
ok 1 - example1.SimpleTest#aFastTest
 ---
 message: TestNG Test aFastTest
 severity: '~'
 source: example1.SimpleTest#aFastTest
 datetime: '2011-03-20T01:47:11'
 file: example1.SimpleTest
 line: '~'
 name: aFastTest
 extensions: '~'
 got: '~'
 expected: '~'
 display: '~'
 dump: '~'
 error: '~'
 backtrace: '~'
 ...
ok 2 - example1.SimpleTest#aSlowTest
 ---
 message: TestNG Test aSlowTest
 severity: '~'
 source: example1.SimpleTest#aSlowTest
 datetime: '2011-03-20T01:47:11'
 file: example1.SimpleTest
 line: '~'
 name: aSlowTest
 extensions: '~'
 got: '~'
 expected: '~'
 display: '~'
 dump: '~'
 error: '~'
 backtrace: '~'
 ...</pre>

<p><pre><span style="text-decoration: underline;">fast.tap</span></pre></p>

<pre class="tap" style="font-family:monospace;">1..1
ok 1 - example1.SimpleTest#aFastTest
 ---
 message: TestNG Test aFastTest
 severity: '~'
 source: example1.SimpleTest#aFastTest
 datetime: '2011-03-20T01:47:11'
 file: example1.SimpleTest
 line: '~'
 name: aFastTest
 extensions: '~'
 got: '~'
 expected: '~'
 display: '~'
 dump: '~'
 error: '~'
 backtrace: '~'
 ...</pre>

<p><pre><span style="text-decoration: underline;">slow.tap</span></pre></p>

<pre class="tap" style="font-family:monospace;">1..1
ok 1 - example1.SimpleTest#aSlowTest
 ---
 message: TestNG Test aSlowTest
 severity: '~'
 source: example1.SimpleTest#aSlowTest
 datetime: '2011-03-20T01:47:11'
 file: example1.SimpleTest
 line: '~'
 name: aSlowTest
 extensions: '~'
 got: '~'
 expected: '~'
 display: '~'
 dump: '~'
 error: '~'
 backtrace: '~'
 ...</pre>

<p>tap4j Listeners can generate TAP Streams for TestNG tests for each method, for each class, for each group and for each suite. Nice uhn? :-)</p>

<h2>Tests that get skipped</h2>

<p>In TAP there are two directives: <strong>SKIP </strong>and <strong>TODO</strong>. SKIP is used to mark a test result as skipped, and TODO says that certain method is still not completely implemented. Tests that are skipped by TestNG are then marked as &#8216;not ok&#8217; with the SKIP directive. Let&#8217;s see some sample code.</p>

<pre class="java" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">package</span> <span style="color: #006699;">example1</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.testng.Assert</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.testng.annotations.Listeners</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">org.testng.annotations.Test</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">import</span> <span style="color: #006699;">br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter</span><span style="color: #339933;">;</span>
&nbsp;
@Listeners<span style="color: #009900;">&#40;</span>value<span style="color: #339933;">=</span><span style="color: #009900;">&#123;</span>TestTAPReporter.<span style="color: #000000; font-weight: bold;">class</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>
<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> SkipTest
<span style="color: #009900;">&#123;</span>
 @Test
 <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> aTestThatFails<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
 <span style="color: #009900;">&#123;</span>
   <span style="color: #000000; font-weight: bold;">Assert</span>.<span style="color: #006633;">assertTrue</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">/</span><span style="color: #cc66cc;">0</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// programmatic causing an error in the test</span>
 <span style="color: #009900;">&#125;</span>
&nbsp;
 @Test<span style="color: #009900;">&#40;</span>dependsOnMethods<span style="color: #339933;">=</span><span style="color: #009900;">&#123;</span><span style="color: #339933;">&amp;</span>quot<span style="color: #339933;">;</span>aTestThatFails<span style="color: #339933;">&amp;</span>quot<span style="color: #339933;">;</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>
 <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> aDepedentMethod<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #666666; font-style: italic;">// This method is always skipped</span>
 <span style="color: #009900;">&#123;</span>
   <span style="color: #000000; font-weight: bold;">Assert</span>.<span style="color: #006633;">assertTrue</span><span style="color: #009900;">&#40;</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+system"><span style="color: #003399;">System</span></a>.<span style="color: #006633;">currentTimeMillis</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
 <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span></pre>

<p>In the code above we are intentionally making a mistake in the method aTestThatFails (we try to divide a number by zero). The method aDepedentMethod that depends on this method is then always skipped. Here is the output TAP Stream:</p>

<p><pre><span style="text-decoration: underline;">example1.SkipTest.tap</span></pre></p>

<pre class="tap" style="font-family:monospace;">1..2
not ok 1 - example1.SkipTest#aDepedentMethod # SKIP TestNG test was skipped
 ---
 message: TestNG Test aDepedentMethod
 severity: '~'
 source: example1.SkipTest#aDepedentMethod
 datetime: '2011-03-20T02:55:34'
 file: example1.SkipTest
 line: '~'
 name: aDepedentMethod
 extensions: '~'
 got: '~'
 expected: '~'
 display: '~'
 dump: '~'
 error: '~'
 backtrace: '~'
 ...
not ok 2 - example1.SkipTest#aTestThatFails
 ---
 message: TestNG Test aTestThatFails
 severity: High
 source: example1.SkipTest#aTestThatFails
 datetime: '2011-03-20T02:55:34'
 file: example1.SkipTest
 line: ''
 name: aTestThatFails
 extensions: '~'
 got: '~'
 expected: '~'
 display: '~'
 dump: '~'
 error: / by zero
 backtrace: &amp;quot;java.lang.ArithmeticException: / by zero\n\tat example1.SkipTest.aTestThatFails(SkipTest.java:15)\n\
 \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\
 \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\
 \tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:74)\n\
 \tat org.testng.internal.Invoker.invokeMethod(Invoker.java:673)\n\tat org.testng.internal.Invoker.invokeTestMethod(Invoker.java:846)\n\
 \tat org.testng.internal.Invoker.invokeTestMethods(Invoker.java:1170)\n\tat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:125)\n\
 \tat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:109)\n\tat org.testng.TestRunner.runWorkers(TestRunner.java:1125)\n\
 \tat org.testng.TestRunner.privateRun(TestRunner.java:749)\n\tat org.testng.TestRunner.run(TestRunner.java:600)\n\
 \tat org.testng.SuiteRunner.runTest(SuiteRunner.java:317)\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:312)\n\
 \tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:274)\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:223)\n\
 \tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:86)\n\
 \tat org.testng.TestNG.runSuitesSequentially(TestNG.java:995)\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:920)\n\
 \tat org.testng.TestNG.run(TestNG.java:856)\n\tat org.testng.remote.RemoteTestNG.run(RemoteTestNG.java:110)\n\
 \tat org.testng.remote.RemoteTestNG.initAndRun(RemoteTestNG.java:205)\n\tat org.testng.remote.RemoteTestNG.main(RemoteTestNG.java:174)\n&amp;quot;
 ...</pre>

<p>You can use <a title="br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter" href="https://github.com/kinow/tap4j/blob/master/src/main/java/org/tap4j/ext/testng/TestTAPReporter.java">br.eti.kinoshita.tap4j.ext.testng.TestTAPReporter</a> or <a title="br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter" href="https://github.com/kinow/tap4j/blob/master/src/main/java/org/tap4j/ext/testng/SuiteTAPReporter.java">br.eti.kinoshita.tap4j.ext.testng.SuiteTAPReporter</a>, as both listeners generate information on skipped tests.</p>

<h2>Dependencies</h2>

<p>At moment tap4j listeners don&#8217;t give you an idea of how is the dependency among the tests in your project. It is an issue that has to be better detailed to be implemented in a new version of tap4j. I know there are methods in the TestNG API that can tell you on which method/group a test depends upon. However I would need to sit down and think where to put this information in the TAP Stream. I like checking first how is it being done in Perl and then trying to code it in a way that the information generated by Java is more similar to that generated in Perl.</p>

<p>I created the enhancement issue <a title="Add dependency information in TestNG TAP integration" href="https://sourceforge.net/tracker/?func=detail&amp;aid=3228068&amp;group_id=351793&amp;atid=1470124">3228068</a> in tap4j SF.net project to discuss about dependencies in tap4j TestNG integration. I have to work on a few things in <a title="TestLink" href="http://www.teamst.org">TestLink</a> and Jenkins prior to start developing this integration, but it is in my list of things to do before Easter (this year&#8217;s Easter, of course ;-)).</p>

<hr />

<p>That&#8217;s all folks! I hope this post clarifies a little bit more about TestNG and TAP. Although there is a lot of work to do in this integration, it is already being used by <a title="Jenkins TestLink Plug-in" href="http://wiki.jenkins-ci.org/display/JENKINS/TestLink+Plugin">Jenkins TestLink Plug-in</a> in productive environments as a way to retrieve information about the test results and update TestLink. Just for what it is worth, the plug-in reads the &#8216;extensions&#8217; entry, looking for a file entry that represents a test evidence. This way automated tests can have evidences uploaded into TestLink test executions.</p>

<p>Ah, just one last note, in the following days the classes and packages of the tap4j project may be updated. Probably I will release tap4j 2.0 with the base package org.tap4j instead of br.eti.kinoshita.tap4j. I think it makes the project more &#8216;free&#8217; and &#8216;community-oriented&#8217; rather than using my own domain in it. As the API is very new I believe it is better to take this decision now rather than when it is being used in more projects.</p>

<p>Cheers :-)</p>

    </div>
    <p class="postmetadata">
                <small>tags          [&nbsp;<a
            href="/tag/tap.html"
            rel="tag">tap</a>&nbsp;]&nbsp;
                 [&nbsp;<a
            href="/tag/testng.html"
            rel="tag">testng</a>&nbsp;]&nbsp;
                 [&nbsp;<a
            href="/tag/testing.html"
            rel="tag">testing</a>&nbsp;]&nbsp;
                </small>
                        <br/>
        <small>posted in 
        [&nbsp;<a
            href="/blog.html"
            title="View all posts in blog"
            rel="category tag">blog</a>&nbsp;]&nbsp;
        category </small>
            </p>
    <div id="navigation">
                    &larr;&nbsp;<a href="/2011/03/22/testlink-and-hudson-now-jenkins-short-tutorial-in-automated-software-testing-magazine-issue-march-2011.html" id="navigation-next">Previous post</a>
                            &mdash; <a href="/2011/03/10/getting-the-maximum-from-testng-with-tap.html" id="navigation-next">Next Entries</a>&nbsp;&rarr;
            </div>
</div>
                    <br/>
                </div><!-- /#main -->
                            <div id="copy" class="">
                <p>&copy; <a href="http://kinoshita.eti.br/about"><span
                            class="b">Bru</span><span
                            class="r">no de</span> <span
                            class="a">Paula</span> <span
                            class="s"></span><span
                            class="i">Kinos</span><span
                            class="l">hita</span></a>
                </p>
            </div>
 
                                
            </div><!-- /#right -->
        </div>
    </div>
</body>
</html>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function(){
    $("a[rel^='prettyPhoto']").prettyPhoto({
    	social_tools: false,
    	autoplay_slideshow: false, 
    	hideflash: true, 
    	autoplay: false, 
    	overlay_gallery: false
    });
  });
</script>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-32767310-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
